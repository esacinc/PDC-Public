<div class="row" style="font-family:'Lato'; font-size: 12px;" (window:resize)="onResize($event)">
	<!--@@@PDC-1433 unable to select a single record when there are multiple records of the same file name on the same page -->
      <p-table class="table-striped ui-datatable-odd " #dt [columns]="cols" [value]="filteredFilesData" [lazy]="true" [paginator]="true" [(first)]="offset"
				[rows]="10" [pageLinks]="5" [rowsPerPageOptions]="[10,20,50,100]" [totalRecords]="totalRecords"
				[loading]="loading" [resizableColumns]="true" columnResizeMode="expand" [ngStyle]="{'width':'100%'}"
				(onRowUnselect) ="onRowUnselected($event)" (onRowSelect)="onRowSelected($event)" [(selection)]="selectedFiles" (onLazyLoad)="loadFiles($event)" id="fileDataTable" paginatorPosition="both"
				scrollHeight="500px" [autoLayout]="true" [frozenColumns]="frozenColumns" [scrollable]="true" frozenWidth="150px">
		<ng-template pTemplate="caption">
		<div class="container-fluid ui-helper-clearfix button-container-fluid exportButtonsRow">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                <div *ngIf="totalRecords > 0 && !loading">
                    <h3 style="font-family: 'Lato'; font-size:14px; margin-top:0!important">{{totalRecords > 1 ? 'Total files: ' + totalRecords : 'Total file: ' + totalRecords }}</h3>
                </div>
            </div>
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 manifestDownload">
                <div class="d-flex justify-content-end align-items-center gap-3">
                    <span id="selectedFilesDataCount" *ngIf="!isDownloadDisabled()" style="font-family:'Lato'; font-size:12px; color:#666;">Rows selected: {{selectedFiles.length}}</span>
                    <div class="dropdown">
                        <button
                            tooltip="Exports all selected rows for the current data tab"
                            class="btn btn-primary dropdown-toggle"
                            type="button"
                            id="exportFileManifestDropdown"
                            data-toggle="dropdown"
                            aria-haspopup="true"
                            aria-expanded="false"
                            style="font-weight:bold;"
                            [disabled]="isDownloadDisabled()"
                            (click)="toggleExportFileDropdown()">
                            Export File Manifest
                            <i class="fa fa-chevron-down ml-2"></i>
                        </button>
                        <div class="dropdown-menu" [class.show]="showExportFileDropdown" aria-labelledby="exportFileManifestDropdown">
                            <button
                                class="dropdown-item"
                                (click)="fileTableExportCSV(false, false, 'csv'); toggleExportFileDropdown()"
                                [disabled]="isDownloadDisabled()">
                                <i class="fa fa-file-text mr-2"></i>CSV Format
                            </button>
                            <button
                                class="dropdown-item"
                                (click)="fileTableExportCSV(false, false, 'tsv'); toggleExportFileDropdown()"
                                [disabled]="isDownloadDisabled()">
                                <i class="fa fa-file-text mr-2"></i>TSV Format
                            </button>
                            <button
                                class="dropdown-item"
                                (click)="fileTableExportCSV(false, false, 'pfb'); toggleExportFileDropdown()"
                                [disabled]="isDownloadDisabled()">
                                <i class="fa fa-file-text mr-2"></i>PFB Format
                            </button>
                        </div>
                    </div>
                    <button matTooltip="Please use local download manager to download the files" id="downloadFiles" mat-raised-button mat-primary label="Download Files" (click)="setDownloadBatch()" [disabled]="isDownloadDisabled()" style="font-family:'Lato'; font-size:14px; font-weight:bold; background-color:#387BA8; color:#fff; border-radius:4px; border:none; height:38px; margin-left:10px;">Download Selected Files</button>
                </div>
            </div>
        </div>
    </div>
</div>

		</ng-template>
				<ng-template pTemplate="header" let-columns>
					<tr style="font-size: 12px;" class="safari_only">
						<th class="ui-datatable-tableheader" style="width:50px;overflow: unset;" pFrozenColumn>
							<!-- @@@PDC-7012 - improve checkbox intuitiveness -->
							<label><p-checkbox id="fileDataChk" [(ngModel)]="headercheckbox" binary="true" (onChange)="triggerchangeHeaderCheckbox()"></p-checkbox>
							<mat-select #dataForManifestExport id="dataForManifestExport" class="card-body card-list" [(ngModel)]="selectedHeaderCheckbox"
							(selectionChange)="changeHeaderCheckbox($event)">
								<mat-option *ngFor="let checkboxOption of checkboxOptions" [value]="checkboxOption" (onSelectionChange)="chkBoxSelectionCheck(checkboxOption)">
									{{checkboxOption}}
								</mat-option>
							</mat-select>
							<span style="display:none">Select All</span></label>
						</th>
						<!-- PDC-2795 -->
						<!-- @@@PDC-4978 update links to migrated documentation pages -->
						<th class="ui-datatable-tableheader" style="width:150px" [pSortableColumn]="cols[0].field" pFrozenColumn><a
								href="/pdc/data-dictionary/Study" target="_blank" style="color:white">PDC Study ID</a>
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
						<!-- @@@PDC-262 link headers to data dictionary -->
						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[1].field"><a
								href="/pdc/data-dictionary/Study" target="_blank" style="color:white">Study</a>
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
<!-- 						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[2].field"><a
								href="/pdc/faq#Embargo_Date" target="_blank" style="color:white">Embargo Date</a>
							<p-sortIcon [field]="cols[2].field" ariaLabel="Sort embargo date column in ascending/descending order"></p-sortIcon>
						</th> -->
						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[3].field"><a
								href="/pdc/data-dictionary/File#file_name" target="_blank" style="color:white">File
								Name</a>
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[4].field">
							<div class="ui-datatable-tableheader-flex-container">
								<div>
									<a href="/pdc/data-dictionary/Study%20Run%20Metadata" target="_blank"
										style="color:white">
										Run Metadata<br>ID
									</a>
								</div>
								<div>
									&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
								</div>
							</div>
						</th>
            <th class="ui-datatable-tableheader" [pSortableColumn]="cols[12].field">
              <div class="ui-datatable-tableheader-flex-container">
                <div>
                  <a href="/pdc/data-dictionary/Protocol" target="_blank"
                     style="color:white">
                    Protocol
                  </a>
                </div>
                <div>
                  &nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
                </div>
              </div>
            </th>
						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[5].field"><a
								href="/pdc/data-dictionary/Project" target="_blank" style="color:white">Project</a>
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
						<th rowspan=3 class="ui-datatable-tableheader" [pSortableColumn]="cols[6].field"><a href="/pdc/faq/Files_Download" target="_blank" style="color:white">Data Category</a>
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
						<th rowspan=3 class="ui-datatable-tableheader" [pSortableColumn]="cols[7].field"><a href="/pdc/faq/Files_Download" target="_blank" style="color:white">File Type</a>
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
						<th rowspan=3 class="ui-datatable-tableheader" [pSortableColumn]="cols[8].field">Access
							&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
						</th>
						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[9].field">
							<div class="ui-datatable-tableheader-flex-container">
								<div class="ui-datatable-tableheader-flex-header">
									File<br>Size (MB)
								</div>
								<div class="ui-datatable-tableheader-flex-sorticon">
									&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
								</div>
							</div>
						</th>
						<th class="ui-datatable-tableheader" [pSortableColumn]="cols[11].field">
								<div class="ui-datatable-tableheader-flex-container">
									<div class="ui-datatable-tableheader-flex-header">
										Downloadable
									</div>
									<div class="ui-datatable-tableheader-flex-sorticon">
										&nbsp;<i class="fas fa-sort" style="color: black" ariaLabel="Sort Study in ascending/descending order"></i>
									</div>
								</div>
						</th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-fileData let-rowIndex="rowIndex">
					<tr style="font-size: 11px;" [pSelectableRow]="fileData">
						<td style="width: 50px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;" pFrozenColumn>
							<!-- @@@PDC-7110 - fix checkbox updates -->
							<!-- @@PDC-8279 - fix 508 compliance issues -->
							<label><p-checkbox #browsePageCheckboxes id="fileData-{{rowIndex}}-{{fileData.submitter_id_name}}" [(ngModel)]="selectedFiles" [value]="fileData" class="browsePageCheckboxes"></p-checkbox><span style="display:none">Select this row</span></label>
						</td>
						<td style="width: 100px;word-wrap: break-word; white-space: normal;" pFrozenColumn>{{fileData.pdc_study_id }}</td>
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.submitter_id_name }}</td>
<!-- 						<td [ngClass]="getStyleClass(fileData.embargo_date)" style="width:5%;word-wrap: break-word; white-space: normal;">
							<div *ngIf="fileData.embargo_date == '' || fileData.embargo_date == null">N/A</div>
							{{fileData.embargo_date }}
						</td> -->
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.file_name}}</td>
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.study_run_metadata_submitter_id}}</td>
            <td style="word-wrap: break-word; white-space: normal;">{{fileData.protocol_submitter_id}}</td>
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.project_name}}</td>
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.data_category}}</td>
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.file_type}}</td>
						<td style="word-wrap: break-word; white-space: normal;">{{fileData.access}}</td>

					  <!-- PDC-5603 some metadata files have size zero -->
						<td style="word-wrap: break-word; white-space: normal;">{{(fileData.file_size / 1048576 | number:'.3') == 0.000 ? (fileData.file_size / 1048576 | number:'.4') : (fileData.file_size / 1048576 | number:'.3')  }}
						</td>
						<!-- PDC-6617 remove tooltip data download button -->
						<td style="word-wrap: break-word; white-space: normal;"><span *ngIf="fileData.downloadable == 'No'">{{fileData.downloadable}}</span><span *ngIf="fileData.downloadable == 'Yes'"><button  mat-raised-button mat-primary label="Download Selection" (click)="downloadFile(fileData)" style="font-family:'Lato';background-color: black;color: white;" aria-label="Download">Download&nbsp;&nbsp;&nbsp;<i class="fas fa-download"></i></button></span></td>
					</tr>
				</ng-template>
		<p-paginator rows="10" totalRecords="120"></p-paginator>
      </p-table>
      <br>
    </div>
